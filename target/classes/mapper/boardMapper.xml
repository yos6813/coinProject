<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.zerock.persistence.BoardDAO">
	<!-- project write -->
	<insert id="insertBoard" parameterType="org.zerock.persistence.Board">
		insert into boardTbl(writeUser, writeDate, pNo, projectDate, text, budget, pm, status)
		values(#{writeUser}, #{writeDate}, #{pNo}, #{projectDate}, #{text}, #{budget}, #{pm}, #{status});
	</insert>
	
	<!-- project List & search -->
	<select id="listBoard" parameterType="list" resultType="org.zerock.persistence.Board">
		select * from v_getBoard 
		<choose>
			<when test="type=='pName'">
				where pName like CONCAT('%', #{keyword} , '%')
			</when>
			<when test="type=='pm'">
				where pm like CONCAT('%', #{keyword} , '%')
			</when>
		</choose>
		order by bNo desc;
	</select>
	
	<!-- project view -->
	<select id="viewBoard" resultType="org.zerock.persistence.Board">
		select * from v_getBoard where bNo = #{bNo};
	</select>
	
	<insert id="insertActivity" parameterType="org.zerock.persistence.Board">
		insert into activityTbl(bNo, aName, aDate, aM, aText, aWriteD, aWriteU, aStatus)
		values(#{bNo}, #{aName}, #{aDate}, #{aM}, #{aText}, #{aWriteD}, #{aWriteU}, #{aStatus});
	</insert>
	
	<select id="ActivityList" resultType="org.zerock.persistence.Board">
		select * from v_activityTbl where bNo = #{bNo} order by aNo desc limit #{pageStart}, #{perPageNum};
	</select>
	
	<select id="ActivityList1" resultType="org.zerock.persistence.Board">
		select * from v_activityTbl where bNo = #{bNo} order by aNo desc;
	</select>
	
	<select id="countList1" resultType="org.zerock.persistence.Board">
		select * from v_activityTbl where bNo = #{bNo} and aStatus = '진행중';
	</select>
	<select id="countList2" resultType="org.zerock.persistence.Board">
		select * from v_activityTbl where bNo = #{bNo} and aStatus = '대기';
	</select>
	<select id="countList3" resultType="org.zerock.persistence.Board">
		select * from v_activityTbl where bNo = #{bNo} and aStatus = '완료';
	</select>
	<select id="countList4" resultType="org.zerock.persistence.Board">
		select * from v_activityTbl where bNo = #{bNo} and aStatus = '보류';
	</select>
	<select id="countList5" resultType="org.zerock.persistence.Board">
		select * from v_activityTbl where bNo = #{bNo} and aStatus = '기간초과';
	</select>
	
	<select id="viewActivity" resultType="org.zerock.persistence.Board">
<!-- 		select * from v_getactivityTbl where aNo = #{aNo}; -->
		select b.*, g.* from v_getBoard b left outer join v_activityTbl g on b.bNo = g.bNo where aNo = #{aNo};
	</select>
	
	<select id="listPage" parameterType="list" resultType="org.zerock.persistence.Board">
		select * from v_getBoard where bNo > 0 order by bNo desc limit #{page}, 5;
	</select>
	
	<select id="listCriteria" parameterType="list" resultType="org.zerock.persistence.Board">
		select * from v_getBoard where bNo > 0 order by bNo desc limit #{pageStart}, #{perPageNum};
	</select>
	
	<select id="countPaging" resultType="int">
		select count(bNo) from v_getBoard where bNo > 0;
	</select>
	
	<select id="countAPaging" resultType="int">
		select count(aNo) from v_activityTbl where aNo > 0 and bNo = #{bNo};
	</select>
	
	<select id="countTPaging" resultType="int">
		select count(*) from v_taskTbl where tNo > 0 and aNo = #{aNo};
	</select>
	
	<insert id="insertTask" parameterType="org.zerock.persistence.Board">
		insert into taskTbl(aNo, bNo, tName, tDate, tStatus, tM, tText, tWriteD, tWriteU)
		values(#{aNo}, #{bNo}, #{tName}, #{tDate}, #{tStatus}, #{tM}, #{tText}, #{tWriteD}, #{tWriteU});
	</insert>
	
	<select id="listTask" parameterType="list" resultType="org.zerock.persistence.Board">
		select * from v_taskTbl where aNo = #{aNo} and tNo > 0 order by tNo desc limit #{pageStart}, #{perPageNum};
	</select>
	
	<select id="viewTask" resultType="org.zerock.persistence.Board">
		select b.*, g.*, t.* from v_getBoard b left outer join v_getactivityTbl g on b.bNo = g.bNo left outer join v_taskTbl t on g.aNo = t.aNo
		where tNo = #{tNo};
	</select>
	
	<select id="countTask" resultType="org.zerock.persistence.Board">
		select * from v_statusTbl where bNo = #{bNo};
	</select>
	
	<select id="taskView" resultType="org.zerock.persistence.Board">
		select * from v_getTaskTbl where aNo = #{aNo} order by field(tStatus, '기간초과', '진행중', '보류', '대기', '완료');
	</select>
	
	<delete id="delProject">
		delete from boardTbl where bNo = #{bNo};
	</delete>
	
	<delete id="delActivity">
		delete from activitytbl where bNo = #{bNo};
	</delete>
	
	<delete id="delTask">
		delete from tasktbl where bNo = #{bNo};
	</delete>
	
	<delete id="delA">
		delete from activitytbl where aNo = #{aNo};
	</delete>
	
	<delete id="delT">
		delete from tasktbl where aNo = #{aNo};
	</delete>
	
	<delete id="deleteTask">
		delete from tasktbl where tNo = #{tNo};
	</delete>
	
	<update id="updateP">
		update boardTbl set
			projectDate=#{projectDate}, text=#{text}, budget=#{budget}, pm=#{pm}, status=#{status}
		where bNo = #{bNo};
	</update>
	
	<update id="updateA">
		update activitytbl set
			aName=#{aName}, aDate=#{aDate}, aM=#{aM}, aText=#{aText}, aStatus=#{aStatus}
		where aNo =#{aNo};
	</update>
	
	<update id="updateT">
		update taskTbl set
			tName=#{tName}, tDate=#{tDate}, tStatus=#{tStatus}, tM=#{tM}, tText=#{tText}
		where tNo = #{tNo};
	</update>
</mapper>